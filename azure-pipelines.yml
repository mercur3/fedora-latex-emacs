
###############################################################################
# WARNING                                                                     #
# This file is autogenerated. Do NOT edit this file. Run =./build.py= instead #
###############################################################################

trigger:
  - master
pr:
  autoCancel: true
  branches:
    include:
      - master
pool:
  vmImage: ubuntu-latest
jobs:
  - job: BuildAndPush
    displayName: 'Build & Push Fedora Images'
    strategy:
      matrix:
        f41:
          fedora: '41'

        f42:
          fedora: '42'

        f43:
          fedora: '43'

    pool:
      vmImage: ubuntu-latest
    steps:
      - checkout: self

      # 1) Login to Docker Hub using the service connection
      - task: Docker@2
        displayName: 'Docker Hub Login'
        inputs:
          command: login
          containerRegistry: docker-hub-login

      # 2) Prep
      - script: |
          echo "Building on Fedora $(fedora)"
          printf "Using %d threads" $(nproc)
          cd build
        displayName: 'Prep build context'

      - task: Docker@2
        displayName: 'Build $(fedora)-base'
        inputs:
          command: build
          dockerfile: build/Dockerfile.$(fedora)-base
          tags: |
            mercur3/fedora-latex-emacs:$(fedora)-base

      - task: Docker@2
        displayName: 'Build $(fedora)-medium'
        inputs:
          command: build
          dockerfile: build/Dockerfile.$(fedora)-medium
          tags: |
            mercur3/fedora-latex-emacs:$(fedora)-medium

      - task: Docker@2
        displayName: 'Build $(fedora)-full'
        inputs:
          command: build
          dockerfile: build/Dockerfile.$(fedora)-full
          tags: |
            mercur3/fedora-latex-emacs:$(fedora)-full

      - task: Docker@2
        displayName: 'Push $(fedora)-medium & $(fedora)-full'
        condition: and(succeeded(), ne(variables['Build.Reason'], 'PullRequest'))
        inputs:
          command: push
          containerRegistry: docker-hub-login
          images: |
            mercur3/fedora-latex-emacs:$(fedora)-medium
            mercur3/fedora-latex-emacs:$(fedora)-full

